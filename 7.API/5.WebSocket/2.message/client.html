<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Document</title>
  </head>
  <body>
    <h1>웹 소켓 테스트</h1>
    <input id="msg" type="text" placeholder="메세지 입력" />
    <button onclick="send()">전송</button>
    <div
      id="log"
      style="
        margin-top: 20px;
        width: 400px;
        height: 200px;
        border: 1px solid gray;
        overflow-y: auto;
      "
    ></div>
    <script>
      const socket = new WebSocket("ws://localhost:8000");

      socket.onopen = () => {
        console.log("서버와 연결됨");
      };

      socket.onmessage = (event) => {
        console.log("서버가 한말: ", event.data);
        display(event.data);
      };

      const logDiv = document.getElementById("log");

      function display(message) {
        const msg = JSON.parse(message); //JSON 문자열로 온 서버의 메세지를 자료구조로 바꿈
        console.log(msg);
        if (msg.type == "system") return;

        const div = document.createElement("div");
        div.textContent = msg.content;
        logDiv.appendChild(div);
      }

      function send() {
        const msg = document.getElementById("msg").value;
        //console.log(msg);
        const myMsg = {
          type: "chat",
          content: msg,
        };
        socket.send(JSON.stringify(myMsg));
      }
    </script>
  </body>
</html>
